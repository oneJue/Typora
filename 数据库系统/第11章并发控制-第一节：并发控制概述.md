  * [pdf下载：密码7281](https://url18.ctfile.com/f/22722418-803434693-77fa8b)
  * [专栏目录首页：【专栏必读】（考研复试）数据库系统概论第五版（王珊）专栏学习笔记目录导航及课后习题答案详解](https://blog.csdn.net/qq_39183034/article/details/122771126)

### 文章目录

  * 一：事务运行方式
  *     * （1）概述
    * （2）计算
    * （3）调度
    * （4）串行调度和并发调度
  * 二：并发控制
  *     * （1）并发操作带来的数据不一致性问题
    *       * A：丢失修改
      * B：读脏数据
      * C：不可重复读
    * （2）并发控制概念
    * （3）并发控制任务
    * （4）并发控制方法

# 一：事务运行方式

## （1）概述

事务的运行方式主要分为 **串行** 和 **并行**

  * **串行** ：每个时刻只有一个事务运行
  *  **并行** ：同一时刻可以有多个事务同时运行

串行和并行的优缺点如下表，并行效率的确很高，但是会破坏事务的隔离性。因此 **要在保证一致性的前提下最大限度的提高并发度**

![在这里插入图片描述](https://img-
blog.csdnimg.cn/a9b164eaf8654fa1b885a4da84cc48e4.png?x-oss-
process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5b-r5LmQ5rGf5rmW,size_20,color_FFFFFF,t_70,g_se,x_16)

不过需要注意的是，在操作系统中就说到过，单处理系统中，所谓的并行实际上是 **宏观上的并行运行，微观上的串行运行** ，也即 **交叉并发**

  * 本章探讨的并发特指交叉并发

![在这里插入图片描述](https://img-
blog.csdnimg.cn/bf6114c755ff4cdfb73b614568959fb6.png?x-oss-
process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5b-r5LmQ5rGf5rmW,size_20,color_FFFFFF,t_70,g_se,x_16)

我们把 **允许多个用户同时使用同一个数据库的数据库系统称之为多用户数据库系统**
，在这种系统中，同一时刻并发运行的事务数量相当庞大。例如我们经常在使用的12306就是一个很典型的例子

## （2）计算

**两个事务 S S S和 T T T，其中 S S S有 m m m条指令， T T T有 n n
n条指令，且每个事务内部指令的相对顺序不能错乱，那么可能的执行顺序有 R R R种**

R = C m \+ n m = C m m \+ n = ( m \+ n ) ! m ! n !
R=C^{m}_{m+n}=C^{m+n}_{m}=\frac{(m+n)!}{m!n!} R=Cm+nm​=Cmm+n​=m!n!(m+n)!​

## （3）调度

**调度 ：事务的一次执行顺序称之为一个调度，表示事务的指令在系统中执行的时间顺序、一组事务的调度必须保证**

  * 包含了 **所有事务** 的操作指令
  * 一个事务中 **指令的顺序** 必须保持不变

## （4）串行调度和并发调度

  * **串行调度** ：属于同一事务的指令 **紧挨在一起执行** ，对于有 n n n个事务的事务组，可以有 n n n!个 **有效调度**
  *  **并发调度** ：来自不同事务的指令可以 **交叉执行** 。并发调度有可能会导致错误结果， **仅当并发调度等价于某个串行调度时，则称该并发调度时可串行化的、正确的**

# 二：并发控制

## （1）并发操作带来的数据不一致性问题

**主要有三类数据不一致性问题**

  * 丢失修改
  * 读脏数据
  * 不可重复读

> 以如下飞机订票系统中的活动序列为例  
>  ①甲售票点(事务 T 1 T_{1} T1​)读出某航班的机票余额A，设A=16  
>  ②乙售票点(事务 T 2 T_{2} T2​)读出同一航班的机票余额A，也为16。  
>  ③甲售票点卖出一张机票，修改余额A←A-1，所以A为15，把A写回数据库。  
>  ④乙售票点也卖出一-张机票，修改余额A-A-1，所以A为15，把A写回数据库。

### A：丢失修改

**丢失修改 ：两个以上事务从数据库中读入同一数据并修改，其中后提交事务的提交结果破坏了先提交事务的提交结果，导致了先提交事务对数据库的修改丢失**

在上面例子中，两个事务 T 1 T_{1} T1​和 T 2 T_{2} T2​读入同一数据并修改，但是 T 2 T_{2} T2​提交的结果破坏了 T 1
T_{1} T1​提交的结果，导致 T 1 T_{1} T1​的修改被丢失

### B：读脏数据

**读脏数据
：事务1修改某一数据，并将其写回磁盘；事务2读取同一数据后，事务1由于某种原因被撤销，这时事务1已修改过的数据被恢复为原值，事务2读到的不稳定的瞬间数据就与数据库中的数据产生了不一致，是不正确的数据，又称为脏数据**

例如 T 1 T_{1} T1​将C值修改为200， T 2 T_{2} T2​读到C为200，此时 T 1 T_{1}
T1​由于某种原因被撤销，因此C恢复为原值100，这时 T 2 T_{2} T2​读到的C为200，属于读脏

![在这里插入图片描述](https://img-
blog.csdnimg.cn/0514d4be4e0a4bc0b2abf7db3bbce69a.png?x-oss-
process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5b-r5LmQ5rGf5rmW,size_20,color_FFFFFF,t_70,g_se,x_16)

### C：不可重复读

**不可重复读 ：事物1读取数据后，事物2执行更新操作，使事物1无法再现前一次读取结果。共有三种情况**

  * 事物2 **修改了** 事物1所读数据，当事物1再次读该数据时，得到了 **与前一次不同的值**
  * 事务2 **删除了** 其中部分记录，当事务1再次按相同条件读取数据时，发现 **某些记录神秘地消失** 了
  * 事务2 **插入了** 一些记录，当事务1再次按相同条件读取数据时，发现 **多了一些记录**

## （2）并发控制概念

**并发控制
：如果多个用户并发存取数据的行为不加以控制，那么极有可能破坏事务的隔离性和一致性。因此并发控制就是为了保证多用户并发操作数据库中信息时的正确性、一致性所采取的措施**

## （3）并发控制任务

  * **对并发操作进行正确调度**
  *  **保证事物的隔离性**
  *  **保证数据库的一致性**

## （4）并发控制方法

  * **加锁（Locking）**
  *  **乐观假设（Optimistic）**
  *  **时间戳（Timestamp）**
  *  **多版本并发控制（MVCC）**


 

- [指导获取：密码7281](https://url18.ctfile.com/f/22722418-803125355-edf378)
- [专栏目录首页：【专栏必读】王道考研408计算机网络+湖科大教书匠计算机网络+网络编程万字笔记、题目题型总结、注意事项、目录导航和思维导图](https://zhangxing-tech.blog.csdn.net/article/details/121004242?spm=1001.2014.3001.5502)
- [王道考研408计算机组成原理万字笔记](https://zhangxing-tech.blog.csdn.net/article/details/120664162?spm=1001.2014.3001.5502)
- [王道考研408数据结构+计算机算法设计与分析万字笔记](https://blog.csdn.net/qq_39183034/article/details/121501138?spm=1001.2014.3001.5501)
- [王道考研408计算机网络+湖科大教书匠计算机网络+网络编程万字笔记](https://zhangxing-tech.blog.csdn.net/article/details/125668174)

### 文章目录

- [一：两种指令、两种处理器状态、两种程序](#_10)
- - [（1）特权指令和非特权指令](#1_13)
  - [（2）用户态和核心态](#2_21)
  - [（3）内核程序和应用程序](#3_30)
- [二：操作系统的内核](#_37)
- - [（1）内核](#1_42)
  - - [A：时钟管理](#A_52)
    - [B：中断机制](#B_60)
    - [C：原语](#C_67)
    - [D：系统控制的数据结构及处理](#D_79)
  - [（2）大内核和微内核](#2_88)
- [三：内核态和用户态的相互转换](#_108)

# 一：两种指令、两种处理器状态、两种程序

## （1）特权指令和非特权指令

- **特权指令**：指的是具有**特殊权限**的指令，这类指令权限很大，使用不当将导致系统奔溃。经典的有**清内存，修改页表，修改访问权限**等等。如果所有程序都能使用这些指令，那么不要说别有用心的人会千方百计的利用这些漏洞，我们用户自己可能就先把系统搞坏了。**因此为了保证系统安全，这类指令只能用于操作系统或其他软件，不直接提供给用户使用——特权指令必须在核心态执行**
- **非特权指令**：**为了防止用户程序中使用特权指令，用户态下只能使用非特权指令，核心态下可以使用全部指令**。在用户态下使用特权指令时，将产生中断以阻止用户使用特权指令

## （2）用户态和核心态

**注意**：程序状态字寄存器\(PSW\) 中的某些标志位可以标识当前处理器处于怎样状态

- **用户态**：CPU处于用户态**只可以执行非特权指令**
- **核心态**：CPU处于核心态**可以执行所有指令**

## （3）内核程序和应用程序

- **内核程序**：操作系统的内核程序是系统的管理者，**既可以执行特权指令，也可以执行非特权指令**，运行在 **核心态**
- **应用程序**：为了保证系统能够安全运行，**普通应用程序只能执行非特权指令，运行在用户态**

# 二：操作系统的内核

**内核基本概念：在软件工程思想和结构程序设计方法影响下诞生的现代操作系统，几乎都是层次式的结构，操作系统的各项功能分别被设置在不同的层次上。一些与硬件关联紧密的模块，比如时钟管理、中断处理、设备驱动等处于最底层。其次是运行频率较高的程序，如进程管理、存储器管理和设备管理等。这两部分内容构成了操作系统的内核**

![在这里插入图片描述](https://ziquyun.com/main/csdn/img?url=https%3A%2F%2Fimg-blog.csdnimg.cn%2Fa2198e713ac541c49a5aabdfc6b30895.png%3Fx-oss-process%3Dimage%2Fwatermark%2Ctype_ZHJvaWRzYW5zZmFsbGJhY2s%2Cshadow_50%2Ctext_Q1NETiBA5b-r5LmQ5rGf5rmW%2Csize_20%2Ccolor_FFFFFF%2Ct_70%2Cg_se%2Cx_16&rfUrl=https%3A%2F%2Fzhangxing-tech.blog.csdn.net%2Farticle%2Fdetails%2F120825466)

## （1）内核

**内核概念： 是计算机配置的底层软件，是计算机功能的延伸，其功能主要有**

- 时钟管理
- 中断处理
- 原语
- 对系统资源进行管理  
  ![在这里插入图片描述](https://ziquyun.com/main/csdn/img?url=https%3A%2F%2Fimg-blog.csdnimg.cn%2F1c5ff9c789c340a08895bbf1b95a4110.png%3Fx-oss-process%3Dimage%2Fwatermark%2Ctype_ZHJvaWRzYW5zZmFsbGJhY2s%2Cshadow_50%2Ctext_Q1NETiBA5b-r5LmQ5rGf5rmW%2Csize_20%2Ccolor_FFFFFF%2Ct_70%2Cg_se%2Cx_16&rfUrl=https%3A%2F%2Fzhangxing-tech.blog.csdn.net%2Farticle%2Fdetails%2F120825466)

### A：时钟管理

**时钟管理：在计算机的各种部件中，时钟是最关键的设备。时钟的第一功能是计时，例如**

- 操作系统需要通过时钟管理，向用户提供**标准的系统时间**
- 通过时钟中断的管理，可以实现**进程的切换**

### B：中断机制

- 这一部分可以结合《计算机组成原理》中的中断进行学习，读者可点击链接跳转[【专栏必读】王道考研408计算机组成原理万字笔记（有了它不需要你再做笔记了）：各章节内容概述导航和思维导图](https://blog.csdn.net/qq_39183034/article/details/120664162?spm=1001.2014.3001.5502)

- **中断机制中，只有一小部分属于内核，他们负责保护和恢复中断现场的信息，转移控制权到相关的处理程序。这样可以减少中断的处理时间，提高系统的并行处理能力**

### C：原语

**原语：按层次结构设计的操作系统，底层必然是一些可被调用的公用小程序，他们各自完成一个规定的操作，通常把具有如下特点的程序称为原语\(Atomic Operation\)。定义原语的直接方法是关闭中断，使所有动作不可分割地完成后再打开中断**

- 处于操作系统的最底层，**最接近硬件**
- 这些程序的运行具有**原子性**，其操作只能 **“一气呵成”**（为了系统安全性和便于管理考虑）
- 这些程序的**运行时间都较短**，且**调用频繁**

### D：系统控制的数据结构及处理

**系统控制的数据结构及处理：系统中用来登记状态信息的数据结构有很多，例如作业控制，进程控制块（PCB），设备控制块，各类链表，消息队列，缓冲区，空闲区登记表，内存分配表等等。为了实现有效管理，系统需要一些基本操作，常见的有以下几种**

- **进程管理：** 进程状态管理、进程调度和分派、创建与撤销进程控制块等
- **存储器管理：** 存储器的空间分配和回收、内存信息保护程序、代码对换程序等
- **设备管理** ：缓冲区管理，设备分配和回收

## （2）大内核和微内核

- **操作系统的体系结构可以分为：大内核和微内核**

**大内核 ：将操作系统的主要功能模块都作为系统内核，运行在核心态**

- **优点：** 性能高
- **缺点：** 内核代码庞大，结构混乱，难以维护

**微内核 ：只把最基本的功能保留在内核**

- **优点：** 内核功能少，结构清晰，方便维护
- **缺点：** 需要频繁在核心态和内核态之间切换，性能低

例如库函数和系统调用的区别

![在这里插入图片描述](https://ziquyun.com/main/csdn/img?url=https%3A%2F%2Fimg-blog.csdnimg.cn%2F408f4dfdcf4745f8aa3070b7394e1332.png%3Fx-oss-process%3Dimage%2Fwatermark%2Ctype_d3F5LXplbmhlaQ%2Cshadow_50%2Ctext_Q1NETiBA5b-r5LmQ5rGf5rmW%2Csize_20%2Ccolor_FFFFFF%2Ct_70%2Cg_se%2Cx_16&rfUrl=https%3A%2F%2Fzhangxing-tech.blog.csdn.net%2Farticle%2Fdetails%2F120825466)

# 三：内核态和用户态的相互转换

- **内核态到用户态：执行一条特权指令，修改PSW标志位标识当前状态为“用户态”，此时标志着操作系统让出CPU的使用权**
- **用户态到内核态：由中断触发，硬件自动完成改变状态过程，此时标志着操作系统强行夺回CPU使用权**
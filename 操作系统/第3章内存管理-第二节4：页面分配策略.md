 

- [专栏目录首页：【专栏必读】王道考研408操作系统+Linux系统编程万字笔记、题目题型总结、注意事项、目录导航和思维导图](https://zhangxing-tech.blog.csdn.net/article/details/121004242?spm=1001.2014.3001.5502)

### 文章目录

- [一：页面分配策略](#_5)
- - [（1）驻留集](#1_7)
  - [（2）页面分配策略](#2_24)
  - [（3）调入页面的时机](#3_47)
  - [（4）从哪里调入页面](#4_58)
- [二：其他概念](#_81)
- - [（1）抖动（颠簸）现象](#1_82)
  - [（2）工作集](#2_89)

# 一：页面分配策略

## （1）驻留集

**驻留集：对于分页式虚拟内存，在进程准备执行时，操作系统必须决定读取多少页，也即决定给特定的进程分配多少页框。所以给一个进程分配物理页框的集合就是这个进程的驻留集。在采用了虚拟存储技术的系统中，驻留集大小一般小于进程的总大小。驻留集太大和太小都会对进程或系统产生一定影响，所以要选择一个合适的驻留集大小**

- **若驻留集太小：** 导致缺页频繁，系统需要花费大量时间来处理缺页，实际用于推进进程的时间很少
- **若驻留集太大：** 导致多道程序并发度下降，资源利用率降低

**根据驻留集大小是否可变，可以有如下两种分配方式**

- **固定分配：** 操作系统为每个进程分配一组固定数目的物理块，进程运行期间**不再改变**
- **可变分配：** 先为每个进程分配一定数目的物理块，在进程运行期间，可以根据情况**做适当的增加或者减少**

**根据置换时置换的范围不同，可以有两种置换方式**

- **局部置换：** 发生缺页时**只能选进程自己的**物理块进行置换
- **全局置换**：可以将操作系统保留的**空闲**物理块分配给进程；也可以将**别的进程**持有的物理块置换到外存，然后再分配给缺页进程

## （2）页面分配策略

将上面不同的**分配方式和置换方式**搭配起来，就可以得到下面三种页面分配策略

|  | 局部置换 | 全局置换 |
| --- | --- | --- |
| **固定分配** | ✅ | ❎ |
| **可变分配** | ✅ | ✅ |

- 注意：**没有固定分配全局置换**这种分配策略，因为全局置换意味着一个进程拥有的物理块数必定会改变，因此不可能采用固定分配

**固定分配局部置换：** 系统为每个进程分配**一定数量**的内存块，在整个运行期间**都不改变**；若进程在运行期间发生缺页，则**只能从该进程在内存中的页面中选出一页换出**，然后再调入需要的页面

- 缺点：很难在刚开始就确定应该为每个进程分配多少个物理块才算合理

**可变分配全局置换：** 刚开始会为每个进程分配一定数量的内存块。操作系统会保持**一个空闲物理块队列**，当进程发生缺页时，**从空闲物理块中取出一块分配该进程**；若已经没有空闲物理块了，则可以选择一个**未锁定**（被锁定的可能是很重要的页面）的页面换出外存，再将该物理块分配给缺页的进程

- 使用该策略，**只要进程发生缺页，都将会获得新的物理块**；仅当空闲物理块用完时，系统才会选择一个未锁定的页面调出。**被选择调出的页可能是系统中任何一个进程的页，因此被选中的进程拥有的物理块会减少，缺页率会增加**

**可变分配局部置换：** 刚开始会为每个进程分配一定数量的物理块。当进程发生缺页时，**只允许从该进程自己的物理块中选出一个换出外存**。如果进程在运行中频繁缺页，系统会为该进程多**分配几个物理块**，直至该进程缺页率趋势变得适当且平稳；反之如果缺页率很低，则可以适当**减少**分配给该进程的物理块

- 使用该策略，**会根据缺页率来动态增加或减少进程的物理块**

## （3）调入页面的时机

主要有以下两种调页策略，实际场景中，两种策略会结合使用

**预调页策略：** 根据**局部性原理，一次调入若干相邻的页面可能要比一次只调入一个页面更加高效**，但如果调入的一批页面中大多数都没有被访问，效率就会很低。**因此，需要采用以预测为基础的预调页策略，将预计在不久之后便会被访问的页面预先调入内存**，但目前预测成功率平均不超过50\%

- 这种策略主要用于进程的首次调入，也就是**运行前调入**

**请求调页策略：** 进程在**运行期间发现缺页时才将所缺页面调入内存**。该策略下，调入的页面一定会被访问到，但是由于一次只能调入一页，**所以I/O开销较大**

## （4）从哪里调入页面

复习：[\(王道408考研操作系统\)第三章内存管理-第一节3：覆盖与交换](https://blog.csdn.net/qq_39183034/article/details/121585799?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522164075764616780366551016%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&request_id=164075764616780366551016&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-1-121585799.nonecase&utm_term=%E8%A6%86%E7%9B%96&spm=1018.2226.3001.4450)

具有对换功能的操作系统中，通常会把磁盘空间划分为**文件区和对换区**两部分：其中**文件区主要用于存放文件，追求存储空间利用率**；对换区空间仅占一小部分。**被换出的进程数据就存放在对换区**。由于对换的速度直接影响系统的整体速度，因此对换区空间的管理主要追求换入换出速度，所以对换区**采用连续分配方式**。总之，**对换区的I/O速度要远快于文件区**

![在这里插入图片描述](https://ziquyun.com/main/csdn/img?url=https%3A%2F%2Fimg-blog.csdnimg.cn%2F92c4264f46dc44c1b06a8217878ca94d.png%3Fx-oss-process%3Dimage%2Fwatermark%2Ctype_d3F5LXplbmhlaQ%2Cshadow_50%2Ctext_Q1NETiBA5b-r5LmQ5rGf5rmW%2Csize_20%2Ccolor_FFFFFF%2Ct_70%2Cg_se%2Cx_16&rfUrl=https%3A%2F%2Fzhangxing-tech.blog.csdn.net%2Farticle%2Fdetails%2F121958622)

---

由于对换区磁盘I/O速度要快于文件区，因此就有如下三种情况

**若系统拥有足够的对换区空间：** 页面的调入、调出都是在**内存与对换区**之间进行，这样可以保证**页面的调入、调出速度很快**。在进程运行前，将**相关数据从文件区复制到对换区，之后把需要的页面从对换区调入内存**  
![在这里插入图片描述](https://ziquyun.com/main/csdn/img?url=https%3A%2F%2Fimg-blog.csdnimg.cn%2F83ccd3cb52984e3484fd978abe987206.png%3Fx-oss-process%3Dimage%2Fwatermark%2Ctype_d3F5LXplbmhlaQ%2Cshadow_50%2Ctext_Q1NETiBA5b-r5LmQ5rGf5rmW%2Csize_20%2Ccolor_FFFFFF%2Ct_70%2Cg_se%2Cx_16&rfUrl=https%3A%2F%2Fzhangxing-tech.blog.csdn.net%2Farticle%2Fdetails%2F121958622)  
**若系统缺少足够的对换区空间：** 凡是**不会被修改的数据都直接从文件区调入**，由于这些页面不会被修改，因此**换出时不必写回磁盘**，下一次需要时再从文件区调入即可。**对于可能被修改的部分，换出时需要写回对换区，下次需要时再从对换区调入**

![在这里插入图片描述](https://ziquyun.com/main/csdn/img?url=https%3A%2F%2Fimg-blog.csdnimg.cn%2Fc9c282e86f2f4e1694cf0b82f084ef0f.png%3Fx-oss-process%3Dimage%2Fwatermark%2Ctype_d3F5LXplbmhlaQ%2Cshadow_50%2Ctext_Q1NETiBA5b-r5LmQ5rGf5rmW%2Csize_20%2Ccolor_FFFFFF%2Ct_70%2Cg_se%2Cx_16&rfUrl=https%3A%2F%2Fzhangxing-tech.blog.csdn.net%2Farticle%2Fdetails%2F121958622)  
**UNIX方式：** 运行之前进程有关的数据**全部放在文件区**，所以**未使用过的页面，都可以从文件区调入**；**被使用过页面的换出时，则写回对换区，下次需要直接从对换区调入**  
![在这里插入图片描述](https://ziquyun.com/main/csdn/img?url=https%3A%2F%2Fimg-blog.csdnimg.cn%2F4e1516b476774b9fbac1905b4a97e05d.png%3Fx-oss-process%3Dimage%2Fwatermark%2Ctype_d3F5LXplbmhlaQ%2Cshadow_50%2Ctext_Q1NETiBA5b-r5LmQ5rGf5rmW%2Csize_20%2Ccolor_FFFFFF%2Ct_70%2Cg_se%2Cx_16&rfUrl=https%3A%2F%2Fzhangxing-tech.blog.csdn.net%2Farticle%2Fdetails%2F121958622)

# 二：其他概念

## （1）抖动（颠簸）现象

**抖动：刚换出的页面马上又要换入内存、刚换入的页面马上又要换出外存的频繁的页面调度行为。产生抖动的主要原因是进程频繁访问的页面数目高于可用的物理块数**

- 为了研究应该为每个进程分配多少个物理块， D e n n i n g Denning Denning提出了**工作集**的概念

## （2）工作集

**工作集：指在某段时间间隔里，进程实际访问页面的集合**

- 驻留集：请求分页存储管理中给进程分配的内存块的集合

基于局部性原理，可以用最近访问过的页面来确定工作集。**工作集 W W W可以由时间 t t t和工作集窗口大小 Δ \\Delta Δ来确定**

如下，假设系统为该进程设定的工作集窗口大小为 Δ \\Delta Δ\=5，那么在 t 1 t\_\{1\} t1​进程工作集为\{2,3,5\}；在 t 2 t\_\{2\} t2​进程工作集为\{1,2,3,4\}

![在这里插入图片描述](https://ziquyun.com/main/csdn/img?url=https%3A%2F%2Fimg-blog.csdnimg.cn%2F00ccae2781b645c08145780b8d36b5ed.png%3Fx-oss-process%3Dimage%2Fwatermark%2Ctype_d3F5LXplbmhlaQ%2Cshadow_50%2Ctext_Q1NETiBA5b-r5LmQ5rGf5rmW%2Csize_20%2Ccolor_FFFFFF%2Ct_70%2Cg_se%2Cx_16&rfUrl=https%3A%2F%2Fzhangxing-tech.blog.csdn.net%2Farticle%2Fdetails%2F121958622)

**工作集大小可能小于窗口尺寸**。实际应用中，操作系统可以统计进程的工作集大小，根据工作集大小给进程分配若干内存块。比如窗口尺寸为5，经过一段时间监测后发现某进程的工作集最大为3，那么说明该进程具有良好的局部性，所以可以给该进程分配三个以上的内存块即可满足运行时的需要。  
**一般来说，驻留集大小不能小于工作集大小，否则将导致频繁换页**
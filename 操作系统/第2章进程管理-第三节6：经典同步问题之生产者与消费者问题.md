 

- [指导获取：密码7281](https://url18.ctfile.com/f/22722418-803125355-edf378)
- [专栏目录首页：【专栏必读】王道考研408计算机网络+湖科大教书匠计算机网络+网络编程万字笔记、题目题型总结、注意事项、目录导航和思维导图](https://zhangxing-tech.blog.csdn.net/article/details/121004242?spm=1001.2014.3001.5502)
- [王道考研408计算机组成原理万字笔记](https://zhangxing-tech.blog.csdn.net/article/details/120664162?spm=1001.2014.3001.5502)
- [王道考研408数据结构+计算机算法设计与分析万字笔记](https://blog.csdn.net/qq_39183034/article/details/121501138?spm=1001.2014.3001.5501)
- [王道考研408计算机网络+湖科大教书匠计算机网络+网络编程万字笔记](https://zhangxing-tech.blog.csdn.net/article/details/125668174)

注意：生产者与消费者问题[Linux系统编程](https://blog.csdn.net/qq_39183034/article/details/116207393)专栏有案例讲解

- [Linux系统编程39：多线程之基于阻塞队列生产者与消费者模型](https://blog.csdn.net/qq_39183034/article/details/116310088?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522163664542116780357250542%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&request_id=163664542116780357250542&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_v2~rank_v29-1-116310088.pc_v2_rank_blog_default&utm_term=%E7%94%9F%E4%BA%A7%E8%80%85%E4%B8%8E%E6%B6%88%E8%B4%B9%E8%80%85&spm=1018.2226.3001.4450)
- [Linux系统编程40：多线程之基于环形队列的生产者与消费者模型](https://blog.csdn.net/qq_39183034/article/details/116310101)

---

### 文章目录

- [一：问题概述](#_15)
- [二：分析](#_32)
- [三：具体代码](#_62)
- [四：注意](#_112)

# 一：问题概述

在现实生活中，当我们缺少某些生活用品时，就会到超市去购买。当你到超市时，你的身份就是**消费者**，那么这些商品又是哪里来的呢，自然是供应商，那么它们就是**生产者**，而超市在生产者与消费者之间，就充当了一个**交易场所**。正是这样的方式才使得人类的交易变得高效，**生产者只需要向超市供应商品，消费者只需要去超市购买商品**

**计算机是现实世界的抽象**，因此像这种人类世界的模型，自然也被引入到了计算机当中。**在实际软件开发中，进程或线程就是生产者和消费者，他们分别产生大量数据或消耗大量数据，但是他们之间一般不直接进行交流，而是生产者生产好数据之后把数据交到一个缓冲区中，消费者需要数据时直接从缓冲区中取就可以了**  
![在这里插入图片描述](https://ziquyun.com/main/csdn/img?url=https%3A%2F%2Fimg-blog.csdnimg.cn%2F20210421101952966.png&rfUrl=https%3A%2F%2Fzhangxing-tech.blog.csdn.net%2Farticle%2Fdetails%2F121278992)  
**我们将其总结为321原则——3种关系，2个角色，1个场所**

- **3种关系**：生产者与生产者之间是**互斥**关系，消费者与消费者之间是**互斥**关系，生产者与消费者之间是**同步**关系
- **2个角色**：生产者和消费者
- **1个场所**：它们之间进行数据交互是在一**缓冲区**当中，这个缓冲区可以有多种表现形式

因此，**生产者消费者问题**问题如下

> 一组生产者进程和一组消费者进程共享一个初始为空，大小为n的缓冲区，只有缓冲区没有满时，生产者才可以把数据放入缓冲区，否则必须等待；只有缓冲区不空时，消费者才能从中取出数据，否则必须等待。由于缓冲区属于临界资源，它只允许一个生产者放入数据或一个消费者从中取出数据

# 二：分析

**消费者生产者问题是一类很经典的需要使用信号量\(P、V操作\)来完成互斥和同步的例子，这里PV操作题目分析步骤如下**

**关系分析：找出题目中描述的各个进程，分析它们之间的同步、互斥关系**

- **同步关系：生产者想要放数据必须等待缓冲区没有满；消费者想要取数据必须等待缓冲区没有空**
- **互斥关系：缓冲区为临界资源，各进程必须互斥访问（注意是每一个进程都必须互斥访问）**

**整理思路：根据各进程的操作流程确定P、V操作的大致顺序。**

- 这里要注意生产者放入的的确是数据，但是数据占用的是资源，**所以生产者放入数据实则是资源的减少过程；同时消费者拿掉数据实则是归还资源的过程**
- **生产者每次消耗\( P \)一个缓冲区,并生产\(V\)一个产品；消费者每次消耗\( P \)一个产品,并释放\(V\)一个缓冲区**
- 往缓冲区放入/取走产品需要互斥

**设置信号量：设置需要的信号量，并根据题目条件确定信号量初值**

- **互斥信号量：初值一般设置为1**
- **同步信号量：初值要看对应资源的初始值是多少**

所以，设置如下

```c
semaphore mutex=1;互斥信号量，实现对缓冲区的互斥访问
semaphore empty=n;同步信号量，表示空闲缓冲区数量
semaphore full=0;同步信号量，表示非空闲缓冲区数量，也就是产品数量

```

# 三：具体代码

**实现同步**

- **生产者：将产品放入缓冲区前需要执行P\(empty\)以消耗一个空闲缓冲区；放入缓冲区之后需要执行V\(full\)以增加一个产品数量**
- **消费者：从缓冲区取出产品之前需要执行P\(full\)以消耗一个产品；从缓冲区取出产品之后需要执行V\(empty\)以增加一个空闲缓冲区**

**实现互斥**

- **生产者：将产品放入缓冲区前需要执行P\(mutex\)；放入缓冲区之后需要执行V\(mutex\)**
- **消费者：从缓冲区取出产品之前需要执行P\(mutex\)；从缓冲区取出产品之后V\(mutex\)**

因此代码如下

```c
semaphore mutex=1;互斥信号量，实现对缓冲区的互斥访问
semaphore empty=n;同步信号量，表示空闲缓冲区数量
semaphore full=0;同步信号量，表示非空闲缓冲区数量，也就是产品数量

Producer()
{
            
            
	while(1)
	{
            
            
		//生产者生产数据
		p(empty);要用什么，P一下    //获取空缓冲区
		p(mutex)：互斥夹紧
		//将数据放入缓冲区
		V(mutex)：互斥夹紧
		V(full)：提供什么，V一下    //产品数量增加
	}
}

Producer()
{
            
            
	while(1)
	{
            
            
		p(full);要用什么，P一下    //获取产品
		p(mutex)：互斥夹紧
		//消费者取出产品
		V(mutex)：互斥夹紧
		V(empty)：提供什么，V一下    //空缓冲区增加
		//消费者使用数据
	}

}

```

# 四：注意

**1：实现互斥的P操作一定要在实现同步的P操作之后**

- 如果顺序相反，会导致两个进程**同时阻塞**，但**都希望对方唤醒自己**

**2：V操作顺序可以交换，不会导致阻塞**
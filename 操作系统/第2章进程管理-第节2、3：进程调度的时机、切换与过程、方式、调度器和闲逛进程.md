 

- [指导获取：密码7281](https://url18.ctfile.com/f/22722418-803125355-edf378)
- [专栏目录首页：【专栏必读】王道考研408计算机网络+湖科大教书匠计算机网络+网络编程万字笔记、题目题型总结、注意事项、目录导航和思维导图](https://zhangxing-tech.blog.csdn.net/article/details/121004242?spm=1001.2014.3001.5502)
- [王道考研408计算机组成原理万字笔记](https://zhangxing-tech.blog.csdn.net/article/details/120664162?spm=1001.2014.3001.5502)
- [王道考研408数据结构+计算机算法设计与分析万字笔记](https://blog.csdn.net/qq_39183034/article/details/121501138?spm=1001.2014.3001.5501)
- [王道考研408计算机网络+湖科大教书匠计算机网络+网络编程万字笔记](https://zhangxing-tech.blog.csdn.net/article/details/125668174)

### 文章目录

- [一：进程调度的时机](#_8)
- - [（1）需要进行进程调度与切换的情况](#1_10)
  - [（2）不能进行进程调度与切换的情况](#2_26)
- [二：进程调度的方式](#_34)
- [三：进程的切换与过程](#_48)
- - [（1）进程切换](#1_50)
  - [（2）狭义和广义的进程调度](#2_59)
- [四：补充-Linux中的进程优先级](#Linux_67)
- - [（1）什么是进程的优先级](#1_69)
  - [（2）进程优先级如何表示](#2_79)
  - [（3）PRI和NI](#3PRINI_85)
  - - [A：什么是PRI和NI](#APRINI_86)
    - [B：如何修改进程优先级](#B_96)
- [五：调度器（调度程序）](#_105)
- [六：闲逛进程](#_131)

# 一：进程调度的时机

## （1）需要进行进程调度与切换的情况

**①：当前运行的进程主动放弃处理机**

- **进程正常终止**
- **运行过程中发生异常而终止**
- **进程主动请求阻塞**

**②：当前运行的进程被动放弃处理机**

- **分配给进程的时间片用完**
- **有更紧急的事情需要处理**
- **有更高优先级的进程进入就绪队列**

## （2）不能进行进程调度与切换的情况

- **在处理中断的过程中，由于中断处理过程复杂，与硬件密切相关，很难做到在中断处理过程中进行进程切换**
- **进程在操作系统内核程序临界区中**
- **在原子操作过程中，原则操作不可中断，需要一气呵成**

# 二：进程调度的方式

- 有的系统中，只允许进程主动放弃处理机；而有的系统中，进程可以主动放弃处理机，但是当有更紧急的任务需要处理时，也会被强行剥夺处理机

**进程调度的方式：当某个进程正在处理机上执行时，如果有某个更重要的进程需要处理时（也即优先级更高），此时应该如何分配处理机。分为以下两种方式**

- **非剥夺调度方式（非抢占）**：允许**进程主动放弃处理机**，在运行过程中即便有更紧迫的任务到达时，当前进程依然会继续使用处理机，**直到该进程终止或主动要求进入阻塞态**。该种方式**实现简单，系统开销小但是无法及时处理紧急任务，适合于早期的批处理系统**
- **剥夺调度方式（抢占）**：当一个进程正在处理机上执行时，如果有一个优先级更高的进程需要使用处理机时，则**立即暂停正在执行的进程，将处理机分配给那个优先级更高的进程**。该种方式**可以优先处理更紧急的进程，也可以实现让各种进程按时间片轮转的功能，适合于分时操作系统、实时操作系统**

# 三：进程的切换与过程

## （1）进程切换

**进程切换：进程切换的过程主要完成了**

- 对原来运行进程的各种数据进行**保存**
- 对新的进程的各种数据进行**恢复**

## （2）狭义和广义的进程调度

- **狭义的进程调度**：从就绪队列中**选择一个要运行的进程**（此进程可以是刚刚被暂停执行的进程，也可能是另外一个进程，其中后者便是**进程切换**）
- **广义的进程调度**：包含了**选择一个进程和进程切换**两个步骤

# 四：补充-Linux中的进程优先级

本节内容涉及一个概念就是**进程优先级**，我们可以在Linux中进行深入研究

## （1）什么是进程的优先级

**这里首先要区分优先级和权限的关系**：以食堂举例，你能去学生食堂而不能去职工食堂，这是因为你没有权限，你可以去食堂，但是你却排不上队，这是因为你的优先级不够（你跑的够不够快，排的是不是在前面）

换到进程中，**当进程太多时，进程就需要被合理的管理，总不能谁都抢着去占用CPU，所以CPU分配资源的先后顺序就是进程的优先级**  
在计算机中肯定是**进程数大于CPU的数量**，也就是人数太多而资源太少，因此优先级的作用就显得至关重要，它可以让优先级高的进程有优先执行权利，让那些不重要，优先级低的进程等一等，或者按照到其他CPU。

还是遵循操作系统管理的原则——“先描述，再组织”。你在Linux内核源代码里，在task\_struct中也能看见这部分内容  
![在这里插入图片描述](https://ziquyun.com/main/csdn/img?url=https%3A%2F%2Fimg-blog.csdnimg.cn%2F20210307192348685.png%3Fx-oss-process%3Dimage%2Fwatermark%2Ctype_ZmFuZ3poZW5naGVpdGk%2Cshadow_10%2Ctext_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5MTgzMDM0%2Csize_16%2Ccolor_FFFFFF%2Ct_70&rfUrl=https%3A%2F%2Fzhangxing-tech.blog.csdn.net%2Farticle%2Fdetails%2F126398736)

## （2）进程优先级如何表示

使用命令`ps \-l`可以列出当前用户创建的进程，比如下面我使用`ps \-l`后会列出两个进程，一个进程就是`bash`，另一个则是我刚刚输入的命令  
![在这里插入图片描述](https://ziquyun.com/main/csdn/img?url=https%3A%2F%2Fimg-blog.csdnimg.cn%2F20210307184948806.png%3Fx-oss-process%3Dimage%2Fwatermark%2Ctype_ZmFuZ3poZW5naGVpdGk%2Cshadow_10%2Ctext_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5MTgzMDM0%2Csize_16%2Ccolor_FFFFFF%2Ct_70&rfUrl=https%3A%2F%2Fzhangxing-tech.blog.csdn.net%2Farticle%2Fdetails%2F126398736)  
上面的`UID`实则就是我这用户的身份标识，如果我切换为root用户，可以发现`UID`也换了  
![在这里插入图片描述](https://ziquyun.com/main/csdn/img?url=https%3A%2F%2Fimg-blog.csdnimg.cn%2F20210307185241264.png&rfUrl=https%3A%2F%2Fzhangxing-tech.blog.csdn.net%2Farticle%2Fdetails%2F126398736)

## （3）PRI和NI

### A：什么是PRI和NI

上图中与优先级有关的两个信息是：PRI和NI

- PRI：**代表这个进程执行的优先级，其值越小越早被执行**
- NI：**代表这个进程的NICE值，用于修正进程优先级**

**调整进程时，调整的不是PRI，而是NI，通过修正NI以达到修改PRI。默认情况下PRI是80，nice是0，修正时每修改一次NICE，新的PRI=80+NICE的修正值**  
**NICE的取值范围为\[-20,19\]，因此PRI的范围为\[60,99\]。根据以上描述，NICE为负值时会使优先级变大，NICE为正值会使优先级变小**

### B：如何修改进程优先级

\(一般情况下，不建议修改，因为进程优先级是由操作系统自行完成的\)

这里为了说明清楚，我创建一个C语言文件，让其死循环在后台运行，然后修改其进程优先级。  
![在这里插入图片描述](https://ziquyun.com/main/csdn/img?url=https%3A%2F%2Fimg-blog.csdnimg.cn%2F2021030719103054.png%3Fx-oss-process%3Dimage%2Fwatermark%2Ctype_ZmFuZ3poZW5naGVpdGk%2Cshadow_10%2Ctext_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5MTgzMDM0%2Csize_16%2Ccolor_FFFFFF%2Ct_70&rfUrl=https%3A%2F%2Fzhangxing-tech.blog.csdn.net%2Farticle%2Fdetails%2F126398736)  
**修改时，升级root权限，按top进入资源管理器，然后再按r，接着输入要修改的进程的PID，然后输入NICE值，比如下面我将其进程调至最大**（也就是输入负值，由于最小是-20，所以即便下面我输了一个非常小的数，其结果仍然是-20）  
![在这里插入图片描述](https://ziquyun.com/main/csdn/img?url=https%3A%2F%2Fimg-blog.csdnimg.cn%2F20210307191533855.gif&rfUrl=https%3A%2F%2Fzhangxing-tech.blog.csdn.net%2Farticle%2Fdetails%2F126398736)

# 五：调度器（调度程序）

**调度器（调度程序）：进程的就绪和运行状态的切换由调度程序引起，它主要决定以下两件事情**

- **调度算法**
- **时间片大小**

**以下事件会触发调度程序**

- 创建新进程
- 进程退出
- 运行进程阻塞
- I/O中断发生

**注意**

- 对于**非抢占式调度策略**，只有运行进程**阻塞或退出**时才会触发调度程序工作
- 对于**抢占式调度策略**，**每个时钟中断或k个时钟中断**会触发调度程序工作

# 六：闲逛进程

**闲逛进程：它是调度程序永远的备胎，没有其他就绪进程时，会运行闲逛进程。其特性如下**

- 优先级最低
- 可以是0地址指令，占一个完整的指令周期
- 能耗低
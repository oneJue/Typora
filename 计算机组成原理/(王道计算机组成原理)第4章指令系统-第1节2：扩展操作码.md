 

- [王道考研复习指导获取：密码7281](https://url18.ctfile.com/f/22722418-803125355-edf378?p=7281)
- [专栏目录首页：【专栏必读】王道考研408计算机组成原理万字笔记、题目题型总结、注意事项、目录导航和思维导图](https://zhangxing-tech.blog.csdn.net/article/details/120664162?spm=1001.2014.3001.5502)

### 文章目录

- [一：重述几个概念](#_9)
- [二：为什么要扩展操作码](#_36)
- [三：扩展操作码方法](#_48)
- - [（1）最常用方法](#1_50)
  - [（2）其他方法](#2_95)
- [四：经典例题](#_107)

# 一：重述几个概念

**指令格式：有两部分构成**

- **操作码**
- **地址码**

**根据指令字长是否固定对指令分类：**

- **定长指令字结构**：指令系统中所有指令的长度都相等
- **变长指令字结构**：指令系统中各种指令的长度不固定

**根据操作码字段长度是否固定对指令分类：**

- **定长操作码**：指令系统中所有指令的操作码长度都固定且相同
- **变长操作码**：指令系统中各指令的操作码长度不固定

**所以这里会有以下四种类型：**

- **定长指令字定长操作码**
- **定长指令字变长操作码：本节扩展操作码基于此类进行，也就是说不同地址数的指令会使用不同长度的操作码**
- **变长指令字定长操作码**
- **变长指令字变长操作码**

# 二：为什么要扩展操作码

**如下图，假设指令字长为16位，其中前4位为操作码字段 O P OP OP，另外有3个4位的地址字段 A 1 A\_\{1\} A1​、 A 2 A\_\{2\} A2​和 A 3 A\_\{3\} A3​**

如果4位操作码全部用于三地址指令，由于 2 4 = 16 2\^\{4\}=16 24\=16，所以该结构**仅能表示16条指令**。但这种方式是不合理的，因为所能表示的**指令数是在是太少了**。所以我们要做适当的处理，**使其虽然不能涵盖全部的三地址指令，但是我能在牺牲有限条三地址指令的情况下向下扩展出更多的二地址、一地址、零地址指令，这样一来，所能表示的指令数目将会大大增大**  
![在这里插入图片描述](https://ziquyun.com/main/csdn/img?url=https%3A%2F%2Fimg-blog.csdnimg.cn%2F36f4a1a08b654901bf950783e1fbb541.png&rfUrl=https%3A%2F%2Fzhangxing-tech.blog.csdn.net%2Farticle%2Fdetails%2F120116550)

# 三：扩展操作码方法

## （1）最常用方法

- 以上图为例

**扩展二地址指令：**

- **三地址指令操作码范围为**`0000`\~`1111`
- 将`1111`留作扩展码，也即`1111`开头的指令不再代表三地址指令，此时三地址指令**变更为15条**，**操作码范围为`0000`\~`1110`**
- 于是，二地址指令操作码将会以`1111`开头
- **实际上，CPU在取得一条指令时，一定是直接读入16位，所以只需要根据所读入的是否为`1111`即可判断它是三地址还是二地址指令**

![在这里插入图片描述](https://ziquyun.com/main/csdn/img?url=https%3A%2F%2Fimg-blog.csdnimg.cn%2F836981291c73432e8165ec2d75dedc2d.png&rfUrl=https%3A%2F%2Fzhangxing-tech.blog.csdn.net%2Farticle%2Fdetails%2F120116550)

**扩展一地址指令：**

- **此时二地址指令操作码范围为`1111` `0000`\~`1111` `1111`**
- 将`1111` `1111`留作扩展码，也即`1111` `1111`开头的指令不再代表二地址指令，**此时二地址指令变更为15条，操作码范围`1111` `0000`\~`1111` `1110`**
- 于是，一地址指令操作码将会以`1111` `1111`开头

![在这里插入图片描述](https://ziquyun.com/main/csdn/img?url=https%3A%2F%2Fimg-blog.csdnimg.cn%2F287aae24f37f4662a0785eeb8712550c.png&rfUrl=https%3A%2F%2Fzhangxing-tech.blog.csdn.net%2Farticle%2Fdetails%2F120116550)

**扩展零地址指令：**

- **此时二地址指令操作码范围为`1111` `1111` `0000` \~`1111` `1111` `1111`**

- 将`1111` `1111` `1111`留作扩展码，也即`1111` `1111` `1111`开头的指令不再代表一地址指令，**此时一地址指令变更为15条，操作码范围为`1111` `1111` `0000` \~`1111` `1111` `1110`**

- 于是，零地址指令操作码将会以`1111` `1111` `1111`开头

- 由于**零地址指令不需要再向后扩展**，所以是16条，范围为`1111` `1111` `1111` `0000` \~ `1111` `1111` `1111` `1111`

![在这里插入图片描述](https://ziquyun.com/main/csdn/img?url=https%3A%2F%2Fimg-blog.csdnimg.cn%2Fe21d7d33c60b4c6c9019a8f2380a4560.png&rfUrl=https%3A%2F%2Fzhangxing-tech.blog.csdn.net%2Farticle%2Fdetails%2F120116550)

**总之，在整个扩展过程中，操作码的位数会随着地址码位数的减少而增加。相比于之前的16条三地址指令。经过扩展，仅损失了一个三地址指令，却增加了15条二地址指令、15条一地址指令和16条零地址指令，这是很划算的**

![在这里插入图片描述](https://ziquyun.com/main/csdn/img?url=https%3A%2F%2Fimg-blog.csdnimg.cn%2Fbae4b8bdcc0f44ee92a7380d0c1d9c9a.png%3Fx-oss-process%3Dimage%2Fwatermark%2Ctype_ZHJvaWRzYW5zZmFsbGJhY2s%2Cshadow_50%2Ctext_Q1NETiBA5b-r5LmQ5rGf5rmW%2Csize_19%2Ccolor_FFFFFF%2Ct_70%2Cg_se%2Cx_16&rfUrl=https%3A%2F%2Fzhangxing-tech.blog.csdn.net%2Farticle%2Fdetails%2F120116550)

## （2）其他方法

**上面展示的是扩展操作码比较常用的一种方法，还有很多种设计方案。不过，不论使用哪种方法，在设计时一定要注意以下几点**：

- **不允许短码是长码的前缀，也即短操作码不能与长操作码的前面部分相同**：这一点，类似于**哈夫曼树的前缀编码**，比如`0011`和`0011` `0000`，如果这样设计就会产生歧义
- **各指令操作码不能重复**

通常情况下，**对于使用频率较高的指令，分配较短的操作码；对使用频率较低的指令则分配较长的操作码**，从而尽可能减少指令译码和分析的时间

- 这一点其实可通过哈夫曼树看出

# 四：经典例题

![在这里插入图片描述](https://ziquyun.com/main/csdn/img?url=https%3A%2F%2Fimg-blog.csdnimg.cn%2Fd3f1d22de8ec4c72b85ae2d2d825cf61.png%3Fx-oss-process%3Dimage%2Fwatermark%2Ctype_ZHJvaWRzYW5zZmFsbGJhY2s%2Cshadow_50%2Ctext_Q1NETiBA5b-r5LmQ5rGf5rmW%2Csize_20%2Ccolor_FFFFFF%2Ct_70%2Cg_se%2Cx_16&rfUrl=https%3A%2F%2Fzhangxing-tech.blog.csdn.net%2Farticle%2Fdetails%2F120116550)  
设地址长度为 n n n，上一层留出 m m m种状态，则下一层可以扩展出 m × 2 n m×2\^\{n\} m×2n种状态
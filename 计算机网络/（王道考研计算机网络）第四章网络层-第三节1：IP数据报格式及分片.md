 

- [指导获取：密码7281](https://url18.ctfile.com/f/22722418-803125355-edf378)
- [专栏目录首页：【专栏必读】王道考研408计算机网络+湖科大教书匠计算机网络+网络编程万字笔记、题目题型总结、注意事项、目录导航和思维导图](https://zhangxing-tech.blog.csdn.net/article/details/125668174)
- [王道考研408计算机组成原理万字笔记](https://zhangxing-tech.blog.csdn.net/article/details/120664162?spm=1001.2014.3001.5502)
- [王道考研408数据结构+计算机算法设计与分析万字笔记](https://blog.csdn.net/qq_39183034/article/details/121501138?spm=1001.2014.3001.5501)
- [王道考研408操作系统+Linux系统编程万字笔记](https://zhangxing-tech.blog.csdn.net/article/details/121004242?spm=1001.2014.3001.5502)

### 文章目录

- [一：IP数据报格式](#IP_10)
- [二：IP数据报分片](#IP_40)

# 一：IP数据报格式

- 网络层最重要的便是IP协议，它定义了数据传送的基本单元——**IP数据报**  
  ![在这里插入图片描述](https://ziquyun.com/main/csdn/img?url=https%3A%2F%2Fimg-blog.csdnimg.cn%2F51fdab54eaf342f99ca650ef8e9f4823.png&rfUrl=https%3A%2F%2Fzhangxing-tech.blog.csdn.net%2Farticle%2Fdetails%2F125284942)

---

**IP数据报格式：一个IP分组由首部和数据两部分组成。首部前一部分的长度固定，共20B，是所有IP分组必须具有的。在首部固定部分的后面是一些可选字段，其长度可变，用来提供错误检测及安全等机制。IP 数据报的格式如下图所示**

![在这里插入图片描述](https://ziquyun.com/main/csdn/img?url=https%3A%2F%2Fimg-blog.csdnimg.cn%2F4f257ea0a8884c82a395b6a76ade53a0.png&rfUrl=https%3A%2F%2Fzhangxing-tech.blog.csdn.net%2Farticle%2Fdetails%2F125284942)

- **版本**：指IP的版本，目前广泛使用的版本号为4，即**IPv4**

- **首部长度**：占**4位**，以32位为单位，**最大值为60B** \(15×4B\)。 最常用的**首部长度是20B**，此时不使用任何选项\(即**可选字段**\)

- **区分服务**：用于指示**期望获得哪种类型的服务**

- **总长度**：占**16位**。指**首部和数据之和**的长度，单位为字节，因此**数据报的最大长度为216\-1= 65535B**。以太网帧的最大传送单元\(MTU\)为1500B，因此当一个IP数据报封装成帧时，**数据报的总长度\(首部加数据\) 一定不能超过下面数据链路层的MTU值**

- **标识**：占**16位**。它是一个计数器，**每产生一个数据报就加1**，并赋值给标识字段。但它并不是“序号”\(因为IP是无连接服务\)。当一个数据报的长度超过网络的MTU时，**必须分片**，此时每个数据报片都复制一次标识号，以便能正确重装成原来的数据报

- **标志**：占**3位**。标志字段的**最低位为MF**，MF= 1表示后面还有分片、MF=0表示最后一个分片。标志字段中间的一位是DF，只有当DF=0时才允许分片

- **片偏移**：占**13位**。它**指出较长的分组在分片后某片在原分组中的相对位置**。片偏移以**8个字节**为偏移单位，即每个分片的长度一定是**8B \(64位\)的整数倍**

- **首部校验和**：占**16位**。IP数据报的首部校验和**只校验分组的首部，而不校验数据部分**

- **生存时间（TTL）**：占**8位**。数据报在网络中可通过的路由器数的最大值，**标识分组在网络中的寿命**，以**确保分组不会永远在网络中循环**。路由器在转发分组前，**先把TTL减1**。若TTL被减为0，则该分组**必须丢弃**

- **协议**：占**8位**。指出**此分组携带的数据使用何种协议**，即分组的数据部分**应交给哪个传输层协议**，如TCP、UDP等（值为6表示TCP，值为17表示UDP）

- **源地址字段**：占**4B**，标识**发送方**的IP地址

- **目的地址字段**：占**4B**，标识**接收方**的IP地址

- **可选字段**：占**0-40B**，用于**支持排错、测量及安全**等措施

- **填充**：全0，用于**把首部补成4B的整数倍**

# 二：IP数据报分片

**IP数据报分片：前面说过，最大传送单元（MTU）是指链路层数据报能承载的最大数据量。因此，由于IP数据报被封装在链路层数据报中，所以链路层的MTU严格限制着IP数据报的长度，而且在IP数据报的源与目的地路径上的各段链路可能使用不同的链路层协议，有不同搞得MTU。所以，当IP数据报的总长度大于链路MTU时，就需要将IP数据报中的数据分装在两个或多个较小的IP数据报中，这些较小的数据报称为片**

![在这里插入图片描述](https://ziquyun.com/main/csdn/img?url=https%3A%2F%2Fimg-blog.csdnimg.cn%2F01984eb5bc3244a38e92668d778784e1.png&rfUrl=https%3A%2F%2Fzhangxing-tech.blog.csdn.net%2Farticle%2Fdetails%2F125284942)

**要完成IP数据报的分片与重组，需要借助IP数据报格式中的标识、标志和片偏移**

- **标识**：同一数据报的分片使用**同一标识**
- **标志**：**中间为DF**（DF=1表示禁止分片；DF=0表示允许分片）和**最低位MF**（MF=1表示后面还有分片；MF=0表示最后一片或者没有分片了）
- **片偏移**：指出**较长分组分片后某片在原分组中的相对位置**，以8B位单位

**特别注意：** 除了最后一个分片，每个分片长度一定是**8B的整数倍**

如下是一个分片的典型例子

![在这里插入图片描述](https://ziquyun.com/main/csdn/img?url=https%3A%2F%2Fimg-blog.csdnimg.cn%2F13e9746918104c148f1e9e3408d2772c.png&rfUrl=https%3A%2F%2Fzhangxing-tech.blog.csdn.net%2Farticle%2Fdetails%2F125284942)